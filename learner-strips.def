Bootstrap: docker
From: ubuntu:latest

%post
    DEBIAN_FRONTEND=noninteractive TZ=Etc/UTC apt-get update && apt-get -y install tzdata
    apt-get update && apt-get -y upgrade && \
    apt-get -y install apt-utils gcc automake zlib1g-dev make g++ git curl unzip cmake software-properties-common wget vim && \
    add-apt-repository -y ppa:deadsnakes/ppa && \
    apt-get update && \
    apt-get -y install python3.11 python3-pip python3.11-distutils gringo
    
    update-alternatives --install /usr/bin/python3 python3 /usr/bin/python3.11 1
    
    DEBIAN_FRONTEND=noninteractive apt-get -y install build-essential software-properties-common
    
    rm -r /var/lib/apt/lists/*
    
    git clone -b glucose-reboot https://github.com/audemard/glucose.git
    
    rm -rf /glucose/pfactory
    
    curl -L https://github.com/crillab/pfactory/releases/download/v2.0.0/pfactory-2.0.0.zip --output /tmp/pfactory.zip && cd /tmp && unzip pfactory.zip && mv pfactory-2.0.0 /glucose/pfactory && rm -r /tmp/pf*
    
    cd /glucose/pfactory && autoreconf --install && ./configure && make -j
    
    cd /glucose/simp && make rs -j
    
    apt-get update && apt-get install -y linux-tools-generic
    
    export PATH="/glucose/simp:${PATH}"
    
    pip3 install --no-cache-dir -r /learner-strips/requirements.txt
    
    # Build the strips program
    
%environment
    export PATH="/glucose/simp:${PATH}"

%runscript
    date

%files
    ./sat/src/ /learner-strips/sat/src/
    ./requirements.txt /learner-strips/requirements.txt
